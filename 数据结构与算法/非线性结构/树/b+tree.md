# B+树
## 概述
B+树是B树的一个升级版，相对于B树来说B+树更充分的利用了节点的空间，让查询速度更加稳定，其速度完全接近于二分法查找。为什么说B+树查找的效率要比B树更高、更稳定。
B+树其实和B数是非常相似的，我们先看看相同点
* 根结点至少是一个元素
* 非根结点元素范围： m/2 <= k < m-1

### 不同点
* B+树有两种类型的结点：内部结点（也称索引结点）和叶子结点。内部结点就是非叶子结点，内部结点不能存储数据，只存储索引，数据都存储在叶子结点。
* 内部结点中的key都按照从小到大的顺序排列，对于内部结点中的一个key，左树中的key都小于它，右子树中的key都大于它。叶子结点中的记录也按照key的大小排列。
* 每个叶子结点都存有相邻叶子结点的指针，叶子结点的本身依关键字的大小而自小到大顺序链接
* 父结点存有右孩子的第一个元素的索引。

结合例子，感受一下B+树：

[图-B+树](https://image-static.segmentfault.com/157/438/1574381086-5d81954ca11bb_articlex)

## 规则

（1）B+跟B树不同，B+树的非叶子节点不保存关键字记录的指针，只进行数据索引，这样使得B+树每个非叶子节点所能保存的关键字大大增加；

（2）B+树叶子节点保存了父节点的所有关键字记录的指针，所有数据地址必须要到叶子节点才能获取到。所以每次数据查询的次数都一样；

（3）B+树叶子节点的关键字从小到大有序排列，左边结尾数据都会保存右边节点开始数据的指针。

（4）非叶子节点的子节点数=关键字数（来源百度百科）（根据各种资料 这里有两种算法的实现方式，另一种为非叶节点的关键字数=子节点数-1（来源维基百科)，虽然他们数据排列结构不一样，但其原理还是一样的Mysql 的B+树是用第一种方式实现）;

## 插入操作

对于插入操作很简单，只需要记住一个技巧即可：当结点元素数量大于 m-1 的时候，按中间元素分裂成左右两部分，中间元素分裂到父结点当索引存储，但是本身元素还是分裂右边这一部分的。

下面以一棵5阶B+数的插入过程为例，也就是 m=5，5阶 B+树的结点最小2个元素，最多四个元素。

* 插入 5，10，15，20    

    [图-如插入](https://image-static.segmentfault.com/132/512/1325121146-5d81954d67e35_articlex)

* 插入25，此时元素数量大于4个了，分裂 
    [图-如插入25](https://image-static.segmentfault.com/212/739/2127399930-5d81954e13616_articlex)

* 接着插入26，30，继续分裂
    [图-如插入26，30](https://image-static.segmentfault.com/417/308/4173086827-5d81954ed2058_articlex
    )
    [图-如分裂](https://image-static.segmentfault.com/373/083/37308380-5d81954ff128c_articlex)

## 删除操作

对于删除操作时比B树简单一些的，因为叶子结点有指针的存在，向兄弟结点借元素时，不需要通过父结点了。而是直接通过兄弟结点移动即可（前提是兄弟结点的元素大于 m/2），然后更新父结点的索引；如果兄弟结点的元素不大于 m/2（兄弟结点也没有多余的元素），则将当前结点和兄弟结点合并，而且删除父结点的中的key。

* 初始状态(5阶)
    [图-B+树初始状态](https://image-static.segmentfault.com/544/336/544336573-5d8195509f73c_articlex)

* 删除10，删除后，不满足要求，发现左边兄弟结点有多余的元素，所以去借，接着修改父结点的索引
    [图-删除10](https://image-static.segmentfault.com/190/889/1908896721-5d81955183990_articlex)

* 删除元素5，发现不满足要求（左右结点都没多余的元素），所以，可以和兄弟结点合并，最后修改父结点的索引
    [图-删除5](https://image-static.segmentfault.com/240/654/2406540314-5d819552166dc_articlex)

* 此时，发现父结点也不满足条件，所以索引的更新和B树的自平衡调整步骤一样。(中间元素分裂到父结点当索引存储，但是本身元素还是分裂右边这一部分的)
    [图-父结点](https://image-static.segmentfault.com/833/961/833961075-5d819552bd0cf_articlex)