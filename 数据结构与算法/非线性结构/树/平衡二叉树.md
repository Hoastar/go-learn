# 平衡二叉树

"平衡因子（Balance Factor，简称BF）"：BF(T) = Hl-Hr，其中 Hl和Hr分别为T的左、右子树的高度。
平衡二叉树（Balanced Binary Tree）（AVL树）空树，或者任一结点左、右子树（子树也必须是一颗平衡二叉树）高度差的绝对值不超过1，即 |BF(T)|<=1

平衡之意，如天平，即两边的分量大约相同。如定义，假如一棵树的左右子树的高度之差超过1，如左子树的树高为2，右子树的树高为0，子树树高差的绝对值为2就打破了这个平衡。如依次插入1，2，3三个结点（如下图）后，根结点的右子树树高减去左子树树高为2，树就失去了平衡。

## AVL树的插入时的失衡与调整
### 失衡与调整的引导
平衡二叉树的失衡调整主要是通过旋转最小失衡子树来实现的。

最小失衡子树，在新插入的结点上向上查找，以第一个平衡因子的绝对值超过1的结点为根的子树

在[图-插入结点的二叉树](https://images0.cnblogs.com/blog2015/638988/201506/080001386298697.jpg)中。2结点（左子树树高-右子树树高）的绝对值=2。同理，3结点的平衡因子也为2.此时同时存在了两棵不平衡子树，而以3为根的树是最小的不平衡子树。我们只要将其以3为中心，将最小不平衡树向左旋转，即可得到平衡二叉树，如[图-调整厚的二叉树]。

平衡二叉树的失衡调整主要是通过旋转最小失衡子树来实现的。根据旋转的方向有两种处理方式，左旋和右旋。

旋转的目的就是减少高度，通过降低整棵树的高度来平衡。哪边的树高，就把哪边的树向上旋转。

左旋操作如下：
1. 结点的右孩子(结点)代替此结点位置
2. 右孩子的左子树变为该结点的右子树
3. 结点本身变为右孩子的左子树


右旋操作如下：
1. 结点的左孩子(结点)代替此结点位置
2. 结点的左孩子的右子树变为结点的结点的左子树
3. 将此结点作为左孩子结点的右子树

## AVL树的四种插入结点方式
|插入方式|描述|旋转方式||
-|-|-|-|
|LL|在 A 的左子树根节点的左子树上插入节点而破坏平衡 | 右旋转 |[图-右旋](https://pic2.zhimg.com/v2-373766641d1c03a78f3d7eac803d1f57_b.webp)| 
|RR|在 A 的右子树根节点的右子树上插入节点而破坏平衡 | 左旋转 |[图-左旋](https://picb.zhimg.com/v2-e7044e4965ba640ee9ef35beac407cdc_b.jpg)|
|LR|在 A 的左子树根节点的右子树上插入节点而破坏平衡 | 先左旋后右旋 | [图-先左旋->右旋](https://pic4.zhimg.com/80/v2-f95f74ae3e76458d56ae3208bdde5987_720w.jpg)
|RL|在 A 的右子树根节点的左子树上插入节点而破坏平衡 | 先右旋后左旋 |[图-先右旋->左旋](https://pic2.zhimg.com/80/v2-08181fd36341e5925f732a97f1fe8e3c_720w.jpg)|

总结：
* 在所有的不平衡情况中，都是按照寻找最小不平衡树，然后寻找所属的不平衡类别，再根据4种类别分别进行固定化程序的操作
* LL，LR，RR，RL其实已经为我们提供了最后哪个结点作为新的根指明了方向。如LR最后的根结点为原来的根的左孩子的右孩子，RL型最后的根结点为原来的根的右孩子的左孩子。
* 维护平衡二叉树，最麻烦的地方在于平衡因子的维护。

## 同一搜索树的判别

1. 分别建两棵搜索树的方法
2. 不建树的方法
3. 建一棵数，再判别其他序列是否与该树一致